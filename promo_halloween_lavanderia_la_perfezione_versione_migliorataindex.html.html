<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Offerta Halloween Perfetta | Lavanderia La Perfezione</title>
    <meta
      name="description"
      content="Offerta di Halloween da brividi! Spendi almeno 15€ e il lavaggio di una maglietta è GRATIS. Solo il 31 ottobre presso la nostra sede in Via Dante Alighieri 82, Alessandria."
    />
    <link rel="canonical" href="https://www.tua-lavanderia.it/promo-halloween" />

    <!-- Open Graph / Twitter -->
    <meta property="og:title" content="Sorpresa di Halloween | Lavanderia La Perfezione" />
    <meta property="og:description" content="Il lavaggio di una maglietta è GRATIS con una spesa minima di 15€! Solo il 31 ottobre." />
    <meta property="og:image" content="https://www.tua-lavanderia.it/immagine-social-halloween.jpg" />
    <meta property="og:url" content="https://www.tua-lavanderia.it/promo-halloween" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="it_IT" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Sorpresa di Halloween | Lavanderia La Perfezione" />
    <meta name="twitter:description" content="Offerta imperdibile per Halloween: il lavaggio di una maglietta è GRATIS!" />
    <meta name="twitter:image" content="https://www.tua-lavanderia.it/immagine-social-halloween.jpg" />

    <meta name="theme-color" content="#1a0c24" />

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext x='10' y='70' font-size='70'%3E%F0%9F%91%BB%3C/text%3E%3C/svg%3E" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />

    <!-- Performance: preconnects -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Creepster&family=Poppins:wght@400;600;700;800&display=swap"
      rel="stylesheet"
      media="print"
      onload="this.media='all'"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Creepster&family=Poppins:wght@400;600;700;800&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <!-- Structured data (valid JSON-LD) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "DryCleaningOrLaundry",
        "name": "Lavanderia La Perfezione",
        "url": "https://www.tua-lavanderia.it/",
        "image": "https://www.tua-lavanderia.it/immagine-social-halloween.jpg",
        "telephone": "+39 0131 254147",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Via Dante Alighieri, 82",
          "addressLocality": "Alessandria",
          "postalCode": "15121",
          "addressRegion": "AL",
          "addressCountry": "IT"
        },
        "event": {
          "@type": "SaleEvent",
          "name": "Sorpresa di Halloween",
          "description": "Spendi almeno 15€ e il lavaggio di una maglietta è GRATIS! Mostra il codice HALLOWASH25 in cassa.",
          "startDate": "2025-10-31T09:00:00+01:00",
          "endDate": "2025-10-31T19:00:00+01:00",
          "location": {
            "@type": "Place",
            "name": "Lavanderia La Perfezione",
            "address": {
              "@type": "PostalAddress",
              "streetAddress": "Via Dante Alighieri, 82",
              "addressLocality": "Alessandria",
              "postalCode": "15121",
              "addressRegion": "AL",
              "addressCountry": "IT"
            }
          }
        }
      }
    </script>

    <style>
      :root {
        --bg-dark: #1a0c24;
        --bg-card: rgba(26, 12, 36, 0.85);
        --primary: #ff7a00;
        --primary-dark: #e66a00;
        --accent: #9e4fe6;
        --text-light: #e0d8f0;
        --text-bright: #fff;
        --border-color: rgba(158, 79, 230, 0.4);
        --shadow: rgba(0, 0, 0, 0.6);
        --glow: rgba(255, 122, 0, 0.5);
        --font-main: "Poppins", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        --font-halloween: "Creepster", cursive;
        --transition-speed: 0.2s;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html { scroll-behavior: smooth; }

      body {
        font-family: var(--font-main);
        background-color: var(--bg-dark);
        color: var(--text-light);
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 1.5rem;
        overflow-x: hidden;
      }

      .bg-overlay {
        position: fixed;
        inset: 0;
        background: linear-gradient(rgba(26, 12, 36, 0.6), rgba(26, 12, 36, 0.9));
        z-index: -1;
      }
      .bg-image {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -2;
      }

      .container { max-width: 640px; width: 100%; perspective: 1000px; }

      .card {
        background-color: var(--bg-card);
        border-radius: 24px;
        padding: 2.5rem;
        box-shadow: 0 15px 50px var(--shadow);
        text-align: center;
        border: 2px solid var(--border-color);
        backdrop-filter: blur(8px);
        animation: fadeIn 0.8s ease-out forwards, glowPulse 4s infinite ease-in-out;
      }

      h1,
      h2,
      h3,
      p { margin-bottom: 1rem; }

      h1 {
        font-family: var(--font-halloween);
        font-size: clamp(2.1rem, 8vw, 2.75rem);
        color: var(--text-bright);
        text-shadow: 0 0 15px var(--glow), 0 0 25px var(--accent);
        animation: glitch 5s infinite steps(1);
      }

      h2 {
        font-size: clamp(1.1rem, 5.5vw, 1.5rem);
        color: var(--primary);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-top: -0.5rem;
      }

      h3 {
        font-size: 1.425rem;
        margin: 2rem 0 1.25rem;
        font-weight: 800;
        color: var(--text-bright);
        font-family: var(--font-halloween);
        text-shadow: 0 0 8px var(--glow);
      }

      .lead { font-size: 1.125rem; line-height: 1.7; }
      .scarcity-note { font-size: 0.95rem; color: var(--accent); font-weight: 700; }

      .countdown-wrapper { margin: 1.5rem auto; }
      .countdown {
        background-color: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        padding: 1rem;
        display: flex;
        justify-content: space-around;
        max-width: 480px;
        border: 1px solid var(--border-color);
        margin: 0.5rem auto 0;
      }
      .countdown-item span { color: var(--primary); font-size: 1.75rem; font-weight: 800; }
      .countdown-item p { font-size: 0.875rem; text-transform: uppercase; opacity: 0.85; margin: 0; }

      .btn {
        color: var(--text-bright);
        border: none;
        border-radius: 10px;
        padding: 0.75rem 1.25rem;
        font-weight: 700;
        cursor: pointer;
        font-size: 1rem;
        transition: all var(--transition-speed) ease;
        text-decoration: none;
        display: inline-block;
        background: #2a1539;
        border: 1px solid var(--border-color);
      }
      .btn:hover,
      .btn:focus-visible {
        transform: translateY(-3px) scale(1.03);
        box-shadow: 0 6px 20px var(--glow);
      }
      .btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 3px; }

      .btn-reveal {
        width: 100%;
        max-width: 420px;
        padding: 1.1rem 1.4rem;
        font-size: 1.25rem;
        font-weight: 800;
        background: linear-gradient(45deg, var(--primary), var(--primary-dark));
        box-shadow: 0 0 25px var(--glow);
        animation: pulse 2s infinite ease-in-out;
        border-radius: 50px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .btn-reveal:hover { animation-play-state: paused; }
      .btn-reveal[disabled] { background: #555; cursor: not-allowed; animation: none; box-shadow: none; }

      .hidden { display: none !important; }

      #prize-section { opacity: 0; transition: opacity 0.5s ease-out, transform 0.5s ease-out; transform: translateY(10px); }
      #prize-section.visible { opacity: 1; transform: translateY(0); }

      .coupon-box {
        display: flex; justify-content: center; align-items: center;
        border: 2px dashed var(--border-color);
        border-radius: 12px; padding: 0.75rem;
        max-width: 360px; margin: 0 auto 1.25rem;
        background: rgba(0, 0, 0, 0.25);
        gap: 0.75rem;
      }
      #coupon-code { font-weight: 900; font-size: 1.5rem; letter-spacing: 2px; color: var(--primary); }
      .copy-btn { transition: background-color 0.3s ease, transform var(--transition-speed) ease; }
      .copy-btn.copied { background-color: var(--accent); animation: pop 0.3s ease-out; }

      .cta-buttons { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-bottom: 1rem; }
      .social-share { margin-top: 1.25rem; }

      .steps { display: flex; justify-content: space-around; gap: 1.25rem; flex-wrap: wrap; margin-top: 1rem; }
      .step { flex: 1; min-width: 160px; }
      .step .icon { font-size: 2rem; margin-bottom: 0.5rem; color: var(--accent); display: inline-block; }

      footer { margin-top: 2rem; font-size: 0.95rem; opacity: 0.9; padding-bottom: 3.5rem; }
      .footer-link { color: inherit; text-decoration: underline; }

      .call-btn-fixed { display: none; }
      .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }

      .how-it-works,
      footer { opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
      .how-it-works.is-visible,
      footer.is-visible { opacity: 1; transform: translateY(0); }

      @keyframes fadeIn { from { opacity: 0; transform: translateY(20px) scale(0.97); } to { opacity: 1; transform: translateY(0) scale(1); } }
      @keyframes glowPulse { 0%, 100% { box-shadow: 0 0 20px var(--glow), 0 0 30px var(--accent); } 50% { box-shadow: 0 0 35px var(--glow), 0 0 45px var(--accent); } }
      @keyframes glitch { 0%, 89%, 94% { transform: none; } 90%, 95% { transform: translate(-2px, 2px); } 92%, 98% { transform: translate(3px, -1px); } }
      @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 0 20px var(--glow); } 50% { transform: scale(1.05); box-shadow: 0 0 35px var(--glow); } 100% { transform: scale(1); box-shadow: 0 0 20px var(--glow); } }
      @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.09); } 100% { transform: scale(1); } }

      @media (max-width: 600px) {
        body { padding: 0; }
        .card { border-radius: 0; box-shadow: none; padding: 2rem 1.25rem; min-height: 100vh; animation: fadeIn 0.8s ease-out; }
        .call-btn-fixed {
          display: block; position: fixed; bottom: 0; left: 0; width: 100%;
          background: var(--primary); color: #fff; text-align: center; padding: 1rem;
          font-size: 1.125rem; font-weight: 800; text-decoration: none; z-index: 1000;
          border-top: 2px solid var(--primary-dark);
        }
      }

      @media (prefers-reduced-motion: reduce) {
        * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; scroll-behavior: auto !important; }
      }
    </style>
  </head>
  <body>
    <div class="bg-overlay" aria-hidden="true"></div>
    <picture>
      <source srcset="https://images.unsplash.com/photo-1509592149231-624043b87a93?q=70&w=1400&auto=format&fit=crop&fm=webp" type="image/webp" />
      <source srcset="https://images.unsplash.com/photo-1509592149231-624043b87a93?q=80&w=1400&auto=format&fit=crop&fm=jpg" type="image/jpeg" />
      <img src="https://images.unsplash.com/photo-1509592149231-624043b87a93?q=80&w=1400&auto=format&fit=crop&fm=jpg" class="bg-image" alt="Atmosfera spettrale di Halloween per la promozione della lavanderia." />
    </picture>

    <main class="container">
      <article class="card">
        <header>
          <h1>Lavanderia La Perfezione</h1>
          <h2>Dolcetto o... Bucato Perfetto?</h2>
        </header>

        <p class="lead">Solo per la notte di Halloween, abbiamo una sorpresa da brividi! Spendi almeno 15€ e il lavaggio di <strong>una maglietta è GRATIS</strong>!</p>
        <p class="scarcity-note">L'offerta è valida solo il 31 ottobre per i primi 100 clienti!</p>

        <div id="countdown-wrapper" class="countdown-wrapper" aria-live="polite" aria-atomic="true">
          <h3 id="countdown-header" style="margin-bottom: 0.5rem; color: var(--text-bright); font-weight: 700;"></h3>
          <div id="countdown" class="countdown" role="group" aria-label="Conto alla rovescia">
            <div class="countdown-item"><span id="days">00</span><p>Giorni</p></div>
            <div class="countdown-item"><span id="hours">00</span><p>Ore</p></div>
            <div class="countdown-item"><span id="minutes">00</span><p>Minuti</p></div>
            <div class="countdown-item"><span id="seconds">00</span><p>Secondi</p></div>
          </div>
        </div>

        <button id="reveal-btn" class="btn btn-reveal" aria-controls="prize-section">Scopri la Sorpresa Stregata</button>

        <section id="prize-section" class="hidden" tabindex="-1" aria-labelledby="prize-heading">
          <h3 id="prize-heading">Ecco il tuo Incantesimo di Sconto!</h3>
          <div class="coupon-box">
            <span id="coupon-code" aria-live="polite" aria-atomic="true"></span>
            <button id="copy-btn" class="btn copy-btn" type="button" aria-describedby="copy-feedback">Copia Incantesimo</button>
            <span class="sr-only" id="copy-feedback" aria-live="polite"></span>
          </div>

          <p>Aggiungi un promemoria per non dimenticare!</p>
          <div class="cta-buttons">
            <a id="calendar-google-link" href="#" target="_blank" rel="noopener" class="btn" aria-label="Aggiungi a Google Calendar">Google Calendar</a>
            <a id="calendar-ics-link" href="#" class="btn" aria-label="Scarica file calendario .ics">Altri calendari</a>
          </div>

          <div class="social-share">
            <p>Spaventa un amico con questa offerta!</p>
            <div class="cta-buttons">
              <a id="share-whatsapp" href="#" target="_blank" rel="noopener" class="btn" aria-label="Condividi su WhatsApp">WhatsApp</a>
              <a id="share-facebook" href="#" target="_blank" rel="noopener" class="btn" aria-label="Condividi su Facebook">Facebook</a>
              <a id="share-telegram" href="#" target="_blank" rel="noopener" class="btn" aria-label="Condividi su Telegram">Telegram</a>
            </div>
          </div>
        </section>

        <section class="how-it-works" aria-labelledby="how-it-works-heading">
          <h3 id="how-it-works-heading">Come Evocare l'Offerta</h3>
          <div class="steps">
            <div class="step"><p><span class="icon" aria-hidden="true">🧺</span><br /><strong>1. Porta il cesto</strong><br />Vieni il 31 ottobre e spendi almeno 15€.</p></div>
            <div class="step"><p><span class="icon" aria-hidden="true">🔮</span><br /><strong>2. Recita l'incantesimo</strong><br />Mostra questo codice magico in cassa.</p></div>
            <div class="step"><p><span class="icon" aria-hidden="true">✨</span><br /><strong>3. Goditi la magia</strong><br />Il lavaggio per la tua maglietta sarà gratis!</p></div>
          </div>
        </section>

        <footer>
          <p><strong>Lavanderia La Perfezione</strong></p>
          <p>
            <a id="maps-link" href="#" target="_blank" rel="noopener" class="footer-link">Via Dante Alighieri, 82 - 15121 Alessandria (AL)</a>
          </p>
          <p><a id="tel-link" href="#" class="footer-link">Tel: 0131 254147</a></p>
        </footer>
      </article>
    </main>

    <a id="call-btn-fixed" href="#" class="call-btn-fixed" aria-label="Chiama la lavanderia">Chiama (se hai coraggio)</a>

    <script async src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

    <script>
      (function () {
        "use strict";

        // ===== CONFIGURAZIONE CENTRALE =====
        const config = {
          address: "Via Dante Alighieri, 82, 15121 Alessandria (AL)",
          tel: "+390131254147",
          eventStartDate: "2025-10-31T09:00:00+01:00",
          eventEndDate: "2025-10-31T19:00:00+01:00",
          couponCode: "HALLOWASH25",
          siteUrl: "https://www.tua-lavanderia.it/promo-halloween",
        };

        // ===== SELEZIONE ELEMENTI DOM =====
        const dom = {
          revealBtn: document.getElementById("reveal-btn"),
          prizeSection: document.getElementById("prize-section"),
          copyBtn: document.getElementById("copy-btn"),
          copyFeedback: document.getElementById("copy-feedback"),
          couponCodeEl: document.getElementById("coupon-code"),
          countdownWrapper: document.getElementById("countdown-wrapper"),
          countdownHeader: document.getElementById("countdown-header"),
          days: document.getElementById("days"),
          hours: document.getElementById("hours"),
          minutes: document.getElementById("minutes"),
          seconds: document.getElementById("seconds"),
          mapsLink: document.getElementById("maps-link"),
          telLink: document.getElementById("tel-link"),
          callBtnFixed: document.getElementById("call-btn-fixed"),
          shareWhatsapp: document.getElementById("share-whatsapp"),
          shareFacebook: document.getElementById("share-facebook"),
          shareTelegram: document.getElementById("share-telegram"),
          calendarGoogleLink: document.getElementById("calendar-google-link"),
          calendarIcsLink: document.getElementById("calendar-ics-link"),
        };

        // Guard clause in caso di problemi di mount
        if (!dom.revealBtn || !dom.prizeSection) return;

        // ===== INIZIALIZZAZIONE DATI DINAMICI =====
        function initialize() {
          dom.couponCodeEl.textContent = config.couponCode;

          const mapsUrl = new URL("https://www.google.com/maps/search/");
          mapsUrl.searchParams.set("api", "1");
          mapsUrl.searchParams.set("query", config.address);
          dom.mapsLink.href = mapsUrl.toString();

          dom.telLink.href = `tel:${config.tel}`;
          dom.callBtnFixed.href = `tel:${config.tel}`;

          setupActionLinks();
          setupCountdown();
          setupIntersectionObserver();
        }

        // ===== LOGICA DI RIVELAZIONE E INTERATTIVITÀ =====
        dom.revealBtn.addEventListener("click", () => {
          dom.revealBtn.classList.add("hidden");
          dom.prizeSection.classList.remove("hidden");
          dom.prizeSection.classList.add("visible");
          setTimeout(() => dom.prizeSection.focus(), 80);

          if (typeof window.confetti === "function") {
            window.confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
          }
        });

        dom.copyBtn.addEventListener("click", async () => {
          try {
            if (navigator.clipboard && navigator.clipboard.writeText) {
              await navigator.clipboard.writeText(config.couponCode);
            } else {
              // Fallback per vecchi browser
              const tmp = document.createElement("textarea");
              tmp.value = config.couponCode;
              document.body.appendChild(tmp);
              tmp.select();
              document.execCommand("copy");
              document.body.removeChild(tmp);
            }
            dom.copyBtn.textContent = "Copiato!";
            dom.copyFeedback.textContent = "Codice copiato negli appunti";
            dom.copyBtn.classList.add("copied");
            setTimeout(() => {
              dom.copyBtn.textContent = "Copia Incantesimo";
              dom.copyFeedback.textContent = "";
              dom.copyBtn.classList.remove("copied");
            }, 2200);
          } catch (err) {
            console.error("Errore durante la copia:", err);
            dom.copyBtn.textContent = "Errore";
          }
        });

        // ===== COUNTDOWN INTELLIGENTE A 3 STATI =====
        function setupCountdown() {
          const startDate = new Date(config.eventStartDate).getTime();
          const endDate = new Date(config.eventEndDate).getTime();

          function render(diff, message) {
            dom.countdownHeader.textContent = message;
            dom.days.textContent = String(Math.floor(diff / 864e5)).padStart(2, "0");
            dom.hours.textContent = String(Math.floor((diff % 864e5) / 36e5)).padStart(2, "0");
            dom.minutes.textContent = String(Math.floor((diff % 36e5) / 6e4)).padStart(2, "0");
            dom.seconds.textContent = String(Math.floor((diff % 6e4) / 1000)).padStart(2, "0");
          }

          const countdownInterval = setInterval(() => {
            const now = Date.now();
            let diff, message;

            if (now < startDate) {
              message = "L'incantesimo si attiverà tra:";
              diff = startDate - now;
              render(diff, message);
            } else if (now >= startDate && now < endDate) {
              message = "L'offerta termina tra:";
              diff = endDate - now;
              // auto reveal se non già visibile
              if (!dom.prizeSection.classList.contains("visible")) {
                dom.revealBtn.click();
              }
              render(diff, message);
            } else {
              clearInterval(countdownInterval);
              dom.countdownWrapper.innerHTML =
                '<h3 style="color: var(--primary);">L\'offerta è terminata! Ci vediamo l\'anno prossimo!</h3>';
              dom.revealBtn.setAttribute("disabled", "true");
              dom.revealBtn.textContent = "Offerta scaduta";
            }
          }, 1000);
        }

        // ===== LINK DINAMICI (SHARE & CALENDAR) =====
        function setupActionLinks() {
          const pageUrl = config.siteUrl || window.location.href;
          const shareText = `Offerta stregata alla Lavanderia La Perfezione! Il 31 ottobre il lavaggio di una maglietta è GRATIS con 15€ di spesa. Scopri come: ${pageUrl}`;

          dom.shareWhatsapp.href = `https://api.whatsapp.com/send?text=${encodeURIComponent(shareText)}`;
          dom.shareFacebook.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(pageUrl)}`;
          dom.shareTelegram.href = `https://t.me/share/url?url=${encodeURIComponent(pageUrl)}&text=${encodeURIComponent(shareText)}`;

          // Eventi calendario
          const title = "Offerta Halloween - Lavanderia La Perfezione";
          const description = `Non dimenticare di usare il codice ${config.couponCode} per avere il lavaggio di una maglietta gratis con una spesa di almeno 15€!\nIndirizzo: ${config.address}\nTel: ${config.tel}`;
          const location = config.address;

          // Google Calendar (date in formato YYYYMMDDTHHMMSSZ o con offset)
          const gStart = config.eventStartDate.replace(/[-:]/g, "").replace("+01:00", "");
          const gEnd = config.eventEndDate.replace(/[-:]/g, "").replace("+01:00", "");
          const googleUrl = new URL("https://www.google.com/calendar/render");
          googleUrl.searchParams.set("action", "TEMPLATE");
          googleUrl.searchParams.set("text", title);
          googleUrl.searchParams.set("dates", `${gStart}/${gEnd}`);
          googleUrl.searchParams.set("details", description);
          googleUrl.searchParams.set("location", location);
          dom.calendarGoogleLink.href = googleUrl.toString();

          // ICS file
          const icsStart = config.eventStartDate.replace(/[-:]/g, "").replace("+01:00", "");
          const icsEnd = config.eventEndDate.replace(/[-:]/g, "").replace("+01:00", "");
          const icsContent = [
            "BEGIN:VCALENDAR",
            "VERSION:2.0",
            "PRODID:-//Lavanderia La Perfezione//Promo Halloween//IT",
            "CALSCALE:GREGORIAN",
            "BEGIN:VEVENT",
            `UID:${crypto && crypto.randomUUID ? crypto.randomUUID() : Date.now()}@tua-lavanderia.it`,
            `URL:${pageUrl}`,
            `DTSTART:${icsStart}`,
            `DTEND:${icsEnd}`,
            `SUMMARY:${title}`,
            `DESCRIPTION:${description.replace(/\n/g, "\\n")}`,
            `LOCATION:${location}`,
            "END:VEVENT",
            "END:VCALENDAR",
          ].join("\r\n");

          const icsBlob = new Blob([icsContent], { type: "text/calendar;charset=utf-8" });
          dom.calendarIcsLink.href = URL.createObjectURL(icsBlob);
          dom.calendarIcsLink.download = "promozione-halloween.ics";
        }

        // ===== ANIMAZIONI ALLO SCROLL =====
        function setupIntersectionObserver() {
          const observer = new IntersectionObserver(
            (entries) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting) {
                  entry.target.classList.add("is-visible");
                  observer.unobserve(entry.target);
                }
              });
            },
            { threshold: 0.1 }
          );

          document.querySelectorAll(".how-it-works, footer").forEach((section) => observer.observe(section));
        }

        // Avvio
        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", initialize);
        } else {
          initialize();
        }
      })();
    </script>
  </body>
</html>
